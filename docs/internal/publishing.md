# Publishing

Follow these instructions for releasing a new version of Mesop publicly via PyPI (e.g. `pip install mesop`).

## Bump the version

Update `mesop/pip_package/setup.py` version field to the next version.

## Install locally

From the workspace root, run the following command:

```sh
$ ./scripts/pip.sh
```

This will build the Mesop pip package and install it locally so you can test it.

## Testing locally

### Dev CLI

The above shell script will run the following command:

```sh
$ mesop main.py
```

This will start the Mesop dev server and you can test that hot reload works.

### Gunicorn integration

```sh
$ pip install gunicorn && gunicorn main:me
```

## Upload to PyPI

If the testing above looks good, then continue with uploading to PyPI.

```sh
rm -rf /tmp/mesoprelease-test/venv-twine \
&& virtualenv --python python3 /tmp/mesoprelease-test/venv-twine \
&& source /tmp/mesoprelease-test/venv-twine/bin/activate \
&& pip install --upgrade pip \
&& pip install twine \
&& twine upload mesop*.whl
```

Visit [https://pypi.org/project/mesop/](https://pypi.org/project/mesop/) to see that the new version has been published.

## First-time upload setup

Create a file `~/.pypirc`:

```yaml
[pypi]
  username = __token__
  password = {{password}}
```

You will need to get a PyPI token generated by one of the project maintainers.
